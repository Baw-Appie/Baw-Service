extends ../includes/layout
block extscript
  if(data.service == 1)
    script.
      loadScript('https://www.google.com/recaptcha/api.js')
      function captchaSubmit2() {
      	$("#data_export").submit();
      }
  if(authed)
    script.
      loadScript('https://www.google.com/recaptcha/api.js')
      function captchaSubmit() {
      	$("#data_add").submit();
      }
      $(function(){
        $("#data_add").submit(function(){
          NProgress.start();
          $.ajax({
            type: "post",
            url : "https://#{hostname}/manage/#{data.service}/data_add",
            data : $("#data_add").serialize(),
            success : function s(a){
              if(a.success == true) {
                toastr.success(a.message, a.title); NProgress.done();
              } else {
                toastr.warning(a.message, a.title); NProgress.done();
              }
            },
            error : function error(){ toastr.warning("Baw Service 빠른 설정 적용이 설정을 적용하는 도중 문제가 발생했습니다.", "죄송합니다!");  NProgress.done(); }
          });
          $.pjax.reload('#contents')
          return false;
        });
      });
  script.
    $('.okay button').click(() => {
      var target = event.target
      var element = $(target).parent("div").parent("div")
      $(element).hide()
      var id = $(element).attr("id")
      if($(target).hasClass("okay1") === true){
        var url = "https://#{hostname}/manage/#{data.service}/complete/"+id+"/1"
        var realnoapi = false
      }
      if($(target).hasClass("okay1noapi") === true){
        var url = "https://#{hostname}/manage/#{data.service}/complete/"+id+"/1?noapi=true"
        var realnoapi = true
      }
      if($(target).hasClass("okay2") === true){
        var url = "https://#{hostname}/manage/#{data.service}/complete/"+id+"/2"
        var realnoapi = false
      }
      $.ajax({
          type: 'get',
          url : url,
          success : function s(a){ 
            if(a.success == true){
              toastr.info(a.message, a.title)
            } else {
              toastr.warning(a.message, a.title)
            }
          },
          error : function error(request,status,error){ toastr.warning("Baw Service 빠른 설정 적용이 설정을 적용하는 도중 문제가 발생했습니다."+error, "죄송합니다!"); }
      });
    })

block contents
  .uk-card.uk-card-default.uk-card-body(class='uk-width-auto')
    h3.uk-card-title #{data.name} 목록
    each row, i in rows
      div(id=rows[i]["num"])
        each li, ii in list
          | #{korean[ii]}: #{rows[i][li]}
          br
        br
        div(class="okay")
          button.uk-button.uk-button-primary.okay1
            i(class="fas fa-check-circle")
            |  처리 완료
          button.uk-button.uk-button-default.okay1noapi API 요청 없이 처리 완료
          button.uk-button.uk-button-danger.okay2
            i(class="fas fa-times-circle")
            |  처리 거절
        hr.uk-divider-icon
      
    - if (rows.length == 0)
      p 처리되지 않은 #{data.name}이 없습니다.
      hr.uk-divider-icon
    p Powered by Baw Service
  br
  br
  if(authed)
    .uk-card.uk-card-default.uk-card-body(class='uk-width-auto')
      h3.uk-card-title 수동으로 #{data.name} 데이터 추가
      form(id="data_add")
        div(class="uk-grid-small uk-child-width-expand@s uk-text-center", uk-grid)
          each li, ii in list
            div
              font(size=2)
                p #{korean[ii]}
              input.uk-input(type='text', name=li, placeholder=korean[ii])
          div
            font(size=2)
              p 처리 상태
            input.uk-input(type='text', name='status', placeholder='처리 상태')
        br
        br
        button.uk-button.uk-button-primary.g-recaptcha(type='submit', data-sitekey='6LeKTiwUAAAAANOYA7r37sTyquy_R0ljzSTVS6Bp', data-callback='captchaSubmit')
          i(class="fas fa-plus-circle")
          |  데이터 추가
        hr.uk-divider-icon
        p 본 기능은 Baw Service 인증 사이트만 사용할 수 있습니다.
        p 만약 이 기능의 사용법을 제대로 이해하지 못한다면 사용하지 마세요.
    br
    br
  if(data.service == 1)
    .uk-card.uk-card-default.uk-card-body(class='uk-width-auto')
      h3.uk-card-title #{data.name} 데이터 내보내기
      form(id="data_export", action=`https://${hostname}/manage/${data.service}/data_export`)
        button.uk-button.uk-button-primary.g-recaptcha(type='submit', data-sitekey='6LeKTiwUAAAAANOYA7r37sTyquy_R0ljzSTVS6Bp', data-callback='captchaSubmit2')
          i(class="fas fa-plus-circle")
          |  Excel로 내보내기
        hr.uk-divider-icon
        p 지정된 형식으로 #{data.name} 데이터를 내보냅니다.
    br
    br
